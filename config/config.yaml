# OrbyGlasses Configuration File
# Bio-Mimetic Navigation System for Visually Impaired Users

# Camera/Video Source Settings
camera:
  # Source: 0 for built-in webcam, or URL for IP camera (e.g., "http://192.168.1.100:8080/video")
  source: 0
  width: 320  # Smaller size for better performance
  height: 320  # Smaller size for better performance
  fps: 20  # Target FPS

# Model Settings
models:
  # YOLOv12 Object Detection
  yolo:
    path: "models/yolo/yolo12n.pt"
    confidence: 0.65       # High confidence = fewer false positives
    iou_threshold: 0.45    # IoU threshold for NMS
    device: "mps"          # Device: 'mps' (Apple Silicon), 'cuda', or 'cpu'

  # Depth Estimation (Depth Anything V2)
  depth:
    path: "depth-anything/Depth-Anything-V2-Small-hf"  # Hugging Face model name
    device: "mps"

  # LLM for Narrative Generation
  llm:
    primary: "gemma3:4b"        # Primary model for narrative
    vision: "moondream:latest"  # Vision model for scene understanding
    temperature: 0.7            # Sampling temperature (0-1)
    max_tokens: 150             # Maximum tokens to generate

# Conversational Navigation
conversation:
  enabled: true                      # Enable conversational mode
  model: "gemma3:4b"                 # LLM model for conversations
  temperature: 0.7                   # Response creativity (0-1)
  max_tokens: 200                    # Maximum response length
  voice_input: false                  # Enable voice input (requires microphone)
  activation_phrase: "hey orby"      # Wake phrase to start conversation
  check_interval: 1.0                # How often to check for activation (seconds)

# Social Navigation
social_navigation:
  enabled: true                      # Enable social navigation features
  region: "us"                       # Regional social norm ('us', 'uk', 'japan', etc.)
  voice_announce: true               # Announce social navigation advice through voice

# Audio Settings
audio:
  # Text-to-Speech
  tts_engine: "pyttsx3"
  tts_rate: 180              # Words per minute (clear and understandable)
  tts_volume: 0.9            # Volume (0-1)

  # Echolocation/Spatial Audio
  echolocation_enabled: true   # Enabled for audio beaconing
  spatial_audio: true
  
  # Adaptive Audio Beaconing
  adaptive_beaconing_enabled: true  # Enable adaptive audio beaconing (440Hz for safe paths, 880Hz for obstacles)
  beacon_safe_frequency: 440        # Frequency for safe path beacons (Hz)
  beacon_obstacle_frequency: 880    # Frequency for obstacle warnings (Hz)
  warning_pulse_rate: 0.2           # Warning pulse rate in seconds

# Echolocation Simulation Settings
echolocation:
  # Virtual room dimensions [x, y, z] in meters
  room_dimensions: [10, 10, 3]
  sample_rate: 16000         # Audio sample rate in Hz
  duration: 0.1              # Duration of each beep in seconds

# Reinforcement Learning Prediction
prediction:
  enabled: false  # Disabled for better performance - enable after testing
  model_path: "models/rl/ppo_navigation.zip"
  training_steps: 10000      # Steps for initial training
  save_interval: 1000        # Save checkpoint every N steps

# Safety Settings
safety:
  min_safe_distance: 1.5     # Minimum safe distance in meters
  danger_distance: 0.4       # Immediate danger zone (<0.4m) - very close objects only
  caution_distance: 1.5      # Caution zone (0.4-1.5m)
  emergency_stop_key: "q"    # Key to emergency stop
  max_obstacle_alerts: 3     # Maximum simultaneous obstacle alerts

# Logging Settings
logging:
  level: "INFO"              # DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_file: "data/logs/orbyglass.log"
  save_detections: true      # Log detection data for analysis
  save_frames: false         # Save frames (uses lots of space)

# Performance Tuning
performance:
  audio_update_interval: 5.0      # Seconds between audio updates (ensures sentences complete)
  danger_audio_interval: 3.0      # Faster alerts for danger zone objects (increased to reduce spam)
  stats_interval: 100             # Log stats every N frames
  max_detections: 3               # Focus on top 3 most relevant objects
  depth_skip_frames: 3            # Calculate depth every Nth frame (3 = every 4th frame)

# 3D Mapping Settings
mapping3d:
  enabled: false                   # Disable 3D mapping for better performance
  max_depth: 5.0                  # Reduced maximum depth for performance
  voxel_size: 0.2                 # Larger voxel size for performance
  subsample_step: 10              # Larger subsample for better performance
  update_interval: 0.5            # Slower updates for better performance
  fx: 500                         # Camera focal length X (pixels)
  fy: 500                         # Camera focal length Y (pixels)
  skip_bbox: true                 # Skip bounding boxes for better performance

# SLAM Settings (Visual Simultaneous Localization and Mapping - NO IMU)
slam:
  enabled: true                   # Enable SLAM for indoor navigation
  grid_size: [200, 200]           # Occupancy grid size (width, height) in cells
  grid_resolution: 0.4            # Grid cell size in meters (0.1m = 10cm per cell)
  save_maps: true                 # Save maps for later reuse
  visualize: true                 # Show SLAM visualization window

  # Tracking without IMU
  orb_features: 1000              # Reduced features for better performance
  fast_threshold: 15              # Higher threshold for fewer features but better performance
  min_matches: 8                  # Reduced minimum matches for better performance
  motion_model: true              # Use constant velocity motion model
  pose_smoothing: 0.5             # Moderate smoothing for balance of stability and responsiveness
  temporal_consistency_check: true # Check for physically impossible movements
  max_position_jump: 0.3          # Maximum allowed position jump (m)
  max_rotation_jump: 0.3          # Maximum allowed rotation jump (rad)
  strict_matching: false          # Less strict matching for better performance
  min_tracked_features: 5         # Reduced minimum tracked features for better performance
  keyframe_threshold: 25          # Insert keyframe less frequently for better performance
  reprojection_threshold: 3.0     # Higher threshold for better performance
  min_depth: 0.1                  # Minimum depth for triangulation (m)
  max_depth: 10.0                 # Maximum depth for triangulation (m)
  depth_variance: 0.05            # Higher variance for more flexibility
  pose_alpha: 0.6                 # Pose smoothing factor (balance of smoothness and responsiveness)
  loop_closure: false             # Disable loop closure for better performance
  loop_closure_threshold: 0.6     # Loop closure threshold (0-1)
  bundle_adjustment: false        # Enable bundle adjustment (may slow down)
  ba_interval: 10                 # Perform BA every N keyframes

# Indoor Navigation Settings
indoor_navigation:
  enabled: true                   # Enable goal-oriented indoor navigation (requires SLAM)
  path_planning: true             # Enable A* path planning
  save_locations: true            # Remember named locations

# Trajectory Prediction Settings (Graph Neural Network)
trajectory_prediction:
  enabled: false                  # Enable GNN-based trajectory prediction (EXPERIMENTAL)
  max_history: 10                 # Number of historical positions to track
  prediction_horizon: 3           # Number of future timesteps to predict
  time_step: 0.5                  # Time between predictions (seconds)
  visualize: false                # Show trajectory visualization
  collision_warning: true         # Warn about predicted collisions

# 3D Occupancy Grid Settings (Voxel Grid Map) - FOR REAL-TIME VISUALIZATION
occupancy_grid_3d:
  enabled: true                   # Enable voxel grid visualization
  grid_size: [10.0, 10.0, 2.5]    # Smaller grid for better performance
  resolution: 0.4                 # Lower resolution for better performance
  near_resolution: 0.2            # Reduced resolution for performance
  near_distance: 1.5              # Reduced distance for high res for performance
  far_resolution: 0.4             # Lower resolution beyond 2m
  max_range: 4.0                  # Reduced maximum sensor range for performance
  min_range: 0.1                  # Minimum sensor range in meters
  log_odds_occupied: 1.0          # Moderate convergence speed
  log_odds_free: -0.6             # Moderate free space marking
  log_odds_min: -3.0              # Moderate saturation
  log_odds_max: 3.0               # Moderate saturation
  subsample_step: 20              # Larger subsample for better performance
  update_interval: 1.0            # Slower updates for better performance
  visualize: true                 # Show 3D voxel grid visualization window
  show_2d_slice: false            # Disable 2D slice for better performance
  temporal_consistency: false     # Disable for better performance
  temporal_filtering: false       # Disable temporal filtering for performance
  min_observations: 1             # Minimum observations for better performance
  decay_rate: 0.001               # Slow decay for stability
  max_history_length: 5           # Reduced history length for performance
  history_decay: 0.8              # Lower decay factor for performance

# 3D Point Cloud Viewer Settings (DISABLED - using voxel grid only)
point_cloud_viewer:
  enabled: false                  # DISABLED - focus on voxel grid
  max_points: 100000              # Maximum points to store (100K recommended)
  subsample: 3                    # Subsample every Nth pixel (lower = denser, slower)
  min_depth: 0.1                  # Minimum depth in meters
  max_depth: 5.0                  # Maximum depth in meters
  update_interval: 0.1            # Update frequency in seconds
  visualize: false                # Show visualization window

# Movement Visualizer Settings (NEW)
movement_visualizer:
  enabled: true                   # Enable movement visualization
  canvas_size: [600, 600]         # Smaller canvas for better performance
  trail_length: 150               # Reduced trail length for better performance
  grid_size: 20.0                 # Smaller grid for better performance
  show_velocity: false            # Disable velocity vector for performance
  show_orientation: false         # Disable orientation indicator for performance
  show_grid: false                # Disable coordinate grid for performance
  show_stats: true                # Keep stats for user feedback
