# OrbyGlasses Configuration File
# Bio-Mimetic Navigation System for Visually Impaired Users

# Camera/Video Source Settings - Optimized for Performance
camera:
  # Source: 0 for built-in webcam, or URL for IP camera
  source: 1
  width: 416  # Optimized size for YOLO (416x416 is optimal for YOLOv12)
  height: 416  # Square aspect ratio for best performance
  fps: 30  # Higher FPS for smoother navigation

# Model Settings - Optimized for Speed and Accuracy
models:
  # YOLOv12 Object Detection - Optimized Settings
  yolo:
    path: "models/yolo/yolo12n.pt"
    confidence: 0.7         # Higher confidence for fewer false positives
    iou_threshold: 0.5      # Optimized IoU threshold
    device: "mps"           # Apple Silicon optimization
    half_precision: true    # Use half precision for speed

  # Depth Estimation - Optimized
  depth:
    path: "depth-anything/Depth-Anything-V2-Small-hf"
    device: "mps"
    half_precision: true   # Use half precision for speed
    max_resolution: 480    # Higher resolution for better accuracy

  # LLM for Narrative Generation - Optimized with VLM
  llm:
    primary: "gemma3:4b"      # Fast and efficient 3B model
    vision: "moondream:latest"        # Vision Language Model for scene understanding
    temperature: 0.6             # Slightly lower temperature for consistency
    max_tokens: 100              # Shorter responses for speed
    vlm_enabled: false           # Disable for speed (too slow)
    scene_analysis_interval: 30  # Analyze scene every 30 frames (only if enabled)

# Conversational Navigation - Simple voice commands
conversation:
  enabled: true                      # Enable conversational mode
  model: "gemma3:4b"              # LLM model for conversations
  temperature: 0.7                   # Response creativity (0-1)
  max_tokens: 200                    # Maximum response length
  voice_input: true                  # Enable voice input for blind users
  activation_phrase: "hey orby"      # Wake phrase to start conversation
  check_interval: 1.0                # How often to check for activation (seconds)
  
  # Simple voice commands for blind users
  simple_commands: true              # Enable simple voice commands
  command_phrases:                   # Common phrases blind users might say
    - "what's around me"
    - "is the path clear"
    - "where am I"
    - "help me navigate"
    - "describe the scene"

# Social Navigation
social_navigation:
  enabled: true                      # Enable social navigation features
  region: "us"                       # Regional social norm ('us', 'uk', 'japan', etc.)
  voice_announce: true               # Announce social navigation advice through voice

# Audio Settings
audio:
  # Text-to-Speech
  tts_engine: "pyttsx3"
  tts_rate: 180              # Words per minute (clear and understandable)
  tts_volume: 0.9            # Volume (0-1)

  # Echolocation/Spatial Audio
  echolocation_enabled: true   # Enabled for audio beaconing
  spatial_audio: true
  
  # Adaptive Audio Beaconing - Helpful patterns for blind users
  adaptive_beaconing_enabled: true  # Enable adaptive audio beaconing
  beacon_safe_frequency: 440        # Low tone for safe paths
  beacon_obstacle_frequency: 880    # High tone for obstacles
  warning_pulse_rate: 0.2           # Warning pulse rate in seconds
  
  # Helpful audio patterns
  door_beacon: 660                  # Special tone for doors
  stairs_beacon: 1320              # Special tone for stairs
  clear_path_beacon: 330           # Very low tone for clear paths

# Echolocation Simulation Settings
echolocation:
  # Virtual room dimensions [x, y, z] in meters
  room_dimensions: [10, 10, 3]
  sample_rate: 16000         # Audio sample rate in Hz
  duration: 0.1              # Duration of each beep in seconds

# Reinforcement Learning Prediction
prediction:
  enabled: false  # Disabled for better performance - enable after testing
  model_path: "models/rl/ppo_navigation.zip"
  training_steps: 10000      # Steps for initial training
  save_interval: 1000        # Save checkpoint every N steps

# Safety Settings
safety:
  min_safe_distance: 1.5     # Minimum safe distance in meters
  danger_distance: 0.4       # Immediate danger zone (<0.4m) - very close objects only
  caution_distance: 1.5      # Caution zone (0.4-1.5m)
  emergency_stop_key: "q"    # Key to emergency stop
  max_obstacle_alerts: 3     # Maximum simultaneous obstacle alerts

# Logging Settings
logging:
  level: "DEBUG"              # DEBUG, INFO, WARNING, ERROR, CRITICAL - Changed to DEBUG for performance analysis
  log_file: "data/logs/orbyglass.log"
  save_detections: true      # Log detection data for analysis
  save_frames: false         # Save frames (uses lots of space)

# Performance Tuning - Optimized for High Performance
performance:
  audio_update_interval: 2.0      # Faster audio updates for better responsiveness
  danger_audio_interval: 0.8      # Very fast alerts for danger zone objects
  stats_interval: 100             # Less frequent logging for performance
  max_detections: 5               # Focus on top 5 most relevant objects
  depth_skip_frames: 1            # Calculate depth every 2nd frame (better accuracy)
  frame_skip: 0                   # Process every frame for maximum responsiveness
  enable_multithreading: true     # Use multithreading for parallel processing
  cache_depth_maps: true          # Cache depth maps for speed

# 3D Mapping Settings
mapping3d:
  enabled: false                    # Enable 3D mapping for spatial awareness (was false)
  max_depth: 6.0                  # Better maximum depth (was 5.0)
  voxel_size: 0.15                # Better voxel size for balance (was 0.2)
  subsample_step: 8               # Moderate subsample (was 10)
  update_interval: 0.3            # Better update frequency (was 0.5)
  fx: 500                         # Camera focal length X (pixels)
  fy: 500                         # Camera focal length Y (pixels)
  skip_bbox: true                 # Skip bounding boxes for better performance

# SLAM Settings - Super Accurate Visual Mapping (NO IMU)
slam:
  enabled: true                   # Enable SLAM for indoor navigation
  grid_size: [300, 300]           # High resolution grid for accuracy
  grid_resolution: 0.2             # High resolution for detailed mapping
  save_maps: true                 # Save maps for later reuse
  visualize: true                 # Show SLAM visualization window
  show_map_creation: true         # Show map being created in real-time
  show_camera_trajectory: true    # Show camera path
  show_keyframes: true            # Show keyframe positions
  show_landmarks: true            # Show detected landmarks

  # High accuracy tracking without IMU
  orb_features: 1000              # More features for better accuracy
  fast_threshold: 8               # Lower threshold for more features
  min_matches: 15                 # More matches for stability
  motion_model: true              # Use constant velocity model
  pose_smoothing: 0.8             # Strong smoothing for stability
  temporal_consistency_check: true # Check for physically impossible movements
  max_position_jump: 0.2          # Smaller allowed position jump
  max_rotation_jump: 0.2          # Smaller allowed rotation jump
  strict_matching: true           # Enable strict matching for accuracy
  min_tracked_features: 12         # More tracked features for stability
  keyframe_threshold: 15          # More frequent keyframes for accuracy
  reprojection_threshold: 2.0     # Lower threshold for accuracy
  min_depth: 0.05                 # Very close depth detection
  max_depth: 15.0                 # Extended depth range
  depth_variance: 0.02            # Lower variance for accuracy
  pose_alpha: 0.8                 # Strong smoothing factor
  loop_closure: true              # Enable loop closure for accuracy
  loop_closure_threshold: 0.7     # Higher threshold for better loop closure
  bundle_adjustment: true         # Enable bundle adjustment for accuracy
  ba_interval: 5                  # More frequent bundle adjustment

# Indoor Navigation Settings
indoor_navigation:
  enabled: true                   # Enable goal-oriented indoor navigation (requires SLAM)
  path_planning: true             # Enable A* path planning
  save_locations: true            # Remember named locations

# Trajectory Prediction Settings (Graph Neural Network)
trajectory_prediction:
  enabled: false                  # Enable GNN-based trajectory prediction (EXPERIMENTAL)
  max_history: 10                 # Number of historical positions to track
  prediction_horizon: 3           # Number of future timesteps to predict
  time_step: 0.5                  # Time between predictions (seconds)
  visualize: false                # Show trajectory visualization
  collision_warning: true         # Warn about predicted collisions

# 3D Occupancy Grid Settings - Balanced Accuracy and Speed
occupancy_grid_3d:
  enabled: true                   # Enable voxel grid visualization
  grid_size: [10.0, 10.0, 3.0]    # Smaller grid for speed
  resolution: 0.1                 # Good balance
  near_resolution: 0.05           # High resolution for close objects
  near_distance: 2.0              # Distance for high-res mapping
  far_resolution: 0.15            # Moderate resolution for far objects
  max_range: 5.0                  # Reasonable sensor range
  min_range: 0.1                  # Minimum range
  log_odds_occupied: 1.5          # Moderate occupied signal
  log_odds_free: -1.0             # Free space signal
  log_odds_min: -3.0              # Saturation limits
  log_odds_max: 3.0               # Saturation limits
  subsample_step: 6               # Moderate sampling (faster)
  update_interval: 0.2            # Fast updates
  visualize: true                 # Show 3D voxel grid visualization window
  show_2d_slice: true             # Show 2D slice for better understanding
  temporal_consistency: true      # Enable for accuracy
  temporal_filtering: true        # Enable temporal filtering for accuracy
  min_observations: 2             # Fewer observations needed (faster)
  decay_rate: 0.001               # Slow decay
  max_history_length: 8           # Moderate history
  history_decay: 0.85             # Decay factor
  
  # Interactive controls
  interactive: true                # Enable interactive controls
  mouse_controls: true            # Enable mouse interaction
  keyboard_controls: true          # Enable keyboard controls
  auto_rotate: false              # Manual rotation control
  show_trajectory: true           # Show camera trajectory
  show_landmarks: true            # Show detected landmarks

# 3D Point Cloud Viewer Settings (DISABLED - using voxel grid only)
point_cloud_viewer:
  enabled: false                  # DISABLED - focus on voxel grid
  max_points: 100000              # Maximum points to store (100K recommended)
  subsample: 3                    # Subsample every Nth pixel (lower = denser, slower)
  min_depth: 0.1                  # Minimum depth in meters
  max_depth: 5.0                  # Maximum depth in meters
  update_interval: 0.1            # Update frequency in seconds
  visualize: false                # Show visualization window

# Movement Visualizer Settings (NEW)
movement_visualizer:
  enabled: false                   # Enable movement visualization
  canvas_size: [700, 700]         # Moderate canvas size for balance (was [600, 600])
  trail_length: 200               # Better trail length for accuracy (was 150)
  grid_size: 22.0                 # Better grid for spatial context (was 20.0)
  show_velocity: true             # Enable velocity for movement info (was false)
  show_orientation: true          # Enable orientation for direction info (was false)
  show_grid: true                 # Enable grid for spatial reference (was false)
  show_stats: true                # Show movement statistics
